<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>subsystems/library_manager.hpp</title>
<meta http-equiv="generator" content="ccolour C++ colouriser by Andy Rushton">
</head>
<body lang="en">
<h1>subsystems/library_manager.hpp</h1>
<pre style="background-color: #ffffff">
<span style="color: #ff0099">    1: </span><span style="color: #990000">#ifndef</span> <span style="color: #000000">STLPLUS_LIBRARY_MANAGER</span>
<span style="color: #ff0099">    2: </span><span style="color: #990000">#define</span> <span style="color: #000000">STLPLUS_LIBRARY_MANAGER</span>
<span style="color: #ff0099">    3: </span><span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">    4: </span>
<span style="color: #ff0099">    5: </span><span style="color: #000099">//   Author:    Andy Rushton</span>
<span style="color: #ff0099">    6: </span><span style="color: #000099">//   Copyright: (c) Southampton University 1999-2004</span>
<span style="color: #ff0099">    7: </span><span style="color: #000099">//              (c) Andy Rushton           2004-2009</span>
<span style="color: #ff0099">    8: </span><span style="color: #000099">//   License:   BSD License, see ../docs/license.html</span>
<span style="color: #ff0099">    9: </span>
<span style="color: #ff0099">   10: </span><span style="color: #000099">//   Generalised library manager.</span>
<span style="color: #ff0099">   11: </span>
<span style="color: #ff0099">   12: </span><span style="color: #000099">//   Manages library units in a set of library directories. A unit is both a file</span>
<span style="color: #ff0099">   13: </span><span style="color: #000099">//   on-disk and a data-structure in memory. To use the library manager, you need</span>
<span style="color: #ff0099">   14: </span><span style="color: #000099">//   to:</span>
<span style="color: #ff0099">   15: </span>
<span style="color: #ff0099">   16: </span><span style="color: #000099">//     - design a type based on lm_unit with serialising functions read/write </span>
<span style="color: #ff0099">   17: </span><span style="color: #000099">//     - decide on a file extension for the type</span>
<span style="color: #ff0099">   18: </span><span style="color: #000099">//     - decide on a description of the type</span>
<span style="color: #ff0099">   19: </span><span style="color: #000099">//     - write a create callback for this type</span>
<span style="color: #ff0099">   20: </span><span style="color: #000099">//     - register the file extension, description and callback with the library manager</span>
<span style="color: #ff0099">   21: </span>
<span style="color: #ff0099">   22: </span><span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   23: </span><span style="color: #990000">#include</span> <span style="color: #009900">"subsystems_fixes.hpp"</span>
<span style="color: #ff0099">   24: </span><span style="color: #990000">#include</span> <span style="color: #009900">"ini_manager.hpp"</span>
<span style="color: #ff0099">   25: </span><span style="color: #990000">#include</span> <span style="color: #009900">"smart_ptr.hpp"</span>
<span style="color: #ff0099">   26: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;iostream&gt;</span>
<span style="color: #ff0099">   27: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;string&gt;</span>
<span style="color: #ff0099">   28: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;vector&gt;</span>
<span style="color: #ff0099">   29: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;list&gt;</span>
<span style="color: #ff0099">   30: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;map&gt;</span>
<span style="color: #ff0099">   31: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;time.h&gt;</span>
<span style="color: #ff0099">   32: </span>
<span style="color: #ff0099">   33: </span><span style="color: #990000">namespace</span> <span style="color: #000000">stlplus</span>
<span style="color: #ff0099">   34: </span><span style="color: #330033">{</span>
<span style="color: #ff0099">   35: </span>
<span style="color: #ff0099">   36: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   37: </span>  <span style="color: #000099">// Internals</span>
<span style="color: #ff0099">   38: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   39: </span>
<span style="color: #ff0099">   40: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_library</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   41: </span>  <span style="color: #990000">class</span> <span style="color: #000000">library_manager</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   42: </span>
<span style="color: #ff0099">   43: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   44: </span>  <span style="color: #000099">// unit names</span>
<span style="color: #ff0099">   45: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   46: </span>
<span style="color: #ff0099">   47: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_unit_name</span>
<span style="color: #ff0099">   48: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">   49: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">   50: </span>    <span style="color: #000000">lm_unit_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   51: </span>    <span style="color: #330033">~</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   52: </span>
<span style="color: #ff0099">   53: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   54: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   55: </span>    <span style="color: #990000">void</span> <span style="color: #000000">lowercase</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   56: </span>
<span style="color: #ff0099">   57: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   58: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   59: </span>
<span style="color: #ff0099">   60: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   61: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">istream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   62: </span>
<span style="color: #ff0099">   63: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">to_string</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   64: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   65: </span>
<span style="color: #ff0099">   66: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">   67: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   68: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_type</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   69: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   70: </span>
<span style="color: #ff0099">   71: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   72: </span>  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">l</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   73: </span>  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">l</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   74: </span>
<span style="color: #ff0099">   75: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   76: </span>  <span style="color: #000099">// dependencies</span>
<span style="color: #ff0099">   77: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   78: </span>
<span style="color: #ff0099">   79: </span>  <span style="color: #000099">// dependencies on external files</span>
<span style="color: #ff0099">   80: </span>
<span style="color: #ff0099">   81: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_file_dependency</span>
<span style="color: #ff0099">   82: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">   83: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">   84: </span>    <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   85: </span>    <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">line</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">column</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   86: </span>    <span style="color: #330033">~</span><span style="color: #000000">lm_file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   87: </span>
<span style="color: #ff0099">   88: </span>    <span style="color: #000099">// a path can be retrieved as either a relative path to the library or as a</span>
<span style="color: #ff0099">   89: </span>    <span style="color: #000099">// full path by providing the library path as an argument</span>
<span style="color: #ff0099">   90: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   91: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">path_full</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   92: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_path</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   93: </span>
<span style="color: #ff0099">   94: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">line</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   95: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_line</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">line</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   96: </span>
<span style="color: #ff0099">   97: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">column</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   98: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_column</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">column</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   99: </span>
<span style="color: #ff0099">  100: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  101: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">istream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  102: </span>
<span style="color: #ff0099">  103: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  104: </span>
<span style="color: #ff0099">  105: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  106: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_path</span><span style="color: #330033">;</span> <span style="color: #000099">// file dependencies are stored as paths relative to the containing library</span>
<span style="color: #ff0099">  107: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">m_line</span><span style="color: #330033">;</span>    <span style="color: #000099">// line - starts at 1, 0 means no line/column information</span>
<span style="color: #ff0099">  108: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">m_column</span><span style="color: #330033">;</span>  <span style="color: #000099">// column - starts at 0</span>
<span style="color: #ff0099">  109: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  110: </span>
<span style="color: #ff0099">  111: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  112: </span>
<span style="color: #ff0099">  113: </span>  <span style="color: #000099">// dependencies on other units</span>
<span style="color: #ff0099">  114: </span>
<span style="color: #ff0099">  115: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_unit_dependency</span>
<span style="color: #ff0099">  116: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">  117: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  118: </span>    <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  119: </span>    <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  120: </span>    <span style="color: #330033">~</span><span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  121: </span>
<span style="color: #ff0099">  122: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  123: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  124: </span>
<span style="color: #ff0099">  125: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  126: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_unit_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  127: </span>
<span style="color: #ff0099">  128: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  129: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  130: </span>
<span style="color: #ff0099">  131: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  132: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  133: </span>
<span style="color: #ff0099">  134: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  135: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">istream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  136: </span>
<span style="color: #ff0099">  137: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  138: </span>
<span style="color: #ff0099">  139: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  140: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_library</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  141: </span>    <span style="color: #000000">lm_unit_name</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  142: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  143: </span>
<span style="color: #ff0099">  144: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span><span style="color: #330033">&lt;&lt;</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  145: </span>
<span style="color: #ff0099">  146: </span>  <span style="color: #000099">// the set of all dependencies</span>
<span style="color: #ff0099">  147: </span>
<span style="color: #ff0099">  148: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_dependencies</span>
<span style="color: #ff0099">  149: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">  150: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  151: </span>    <span style="color: #000000">lm_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  152: </span>    <span style="color: #000000">lm_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  153: </span>    <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span><span style="color: #330033">=</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  154: </span>    <span style="color: #330033">~</span><span style="color: #000000">lm_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  155: </span>
<span style="color: #ff0099">  156: </span>    <span style="color: #000099">// source file dependency</span>
<span style="color: #ff0099">  157: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_source_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  158: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">source_file_present</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  159: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  160: </span>
<span style="color: #ff0099">  161: </span>    <span style="color: #000099">// other file dependencies</span>
<span style="color: #ff0099">  162: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">file_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  163: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">file_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  164: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  165: </span>    <span style="color: #990000">void</span> <span style="color: #000000">file_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  166: </span>
<span style="color: #ff0099">  167: </span>    <span style="color: #000099">// unit dependencies</span>
<span style="color: #ff0099">  168: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  169: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  170: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  171: </span>    <span style="color: #990000">void</span> <span style="color: #000000">unit_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  172: </span>
<span style="color: #ff0099">  173: </span>    <span style="color: #990000">void</span> <span style="color: #000000">clear</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  174: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">empty</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  175: </span>
<span style="color: #ff0099">  176: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  177: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">istream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  178: </span>
<span style="color: #ff0099">  179: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  180: </span>
<span style="color: #ff0099">  181: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  182: </span>    <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">*</span> <span style="color: #000000">m_source</span><span style="color: #330033">;</span>            <span style="color: #000099">// source file dependency (optional)</span>
<span style="color: #ff0099">  183: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_files</span><span style="color: #330033">;</span> <span style="color: #000099">// other file dependencies</span>
<span style="color: #ff0099">  184: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_units</span><span style="color: #330033">;</span> <span style="color: #000099">// unit dependencies</span>
<span style="color: #ff0099">  185: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  186: </span>
<span style="color: #ff0099">  187: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  188: </span>
<span style="color: #ff0099">  189: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  190: </span>  <span style="color: #000099">// library unit superclass</span>
<span style="color: #ff0099">  191: </span>  <span style="color: #000099">// user's units must be derivatives of lm_unit and overload all the virtuals</span>
<span style="color: #ff0099">  192: </span>
<span style="color: #ff0099">  193: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_unit</span>
<span style="color: #ff0099">  194: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">  195: </span>    <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_library</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  196: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  197: </span>    <span style="color: #000099">////////////////////////////////////////</span>
<span style="color: #ff0099">  198: </span>    <span style="color: #000099">// constructor/destructor</span>
<span style="color: #ff0099">  199: </span>
<span style="color: #ff0099">  200: </span>    <span style="color: #000000">lm_unit</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">,</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  201: </span>    <span style="color: #990000">virtual</span> <span style="color: #330033">~</span><span style="color: #000000">lm_unit</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  202: </span>
<span style="color: #ff0099">  203: </span>    <span style="color: #000099">////////////////////////////////////////</span>
<span style="color: #ff0099">  204: </span>    <span style="color: #000099">// Header data</span>
<span style="color: #ff0099">  205: </span>
<span style="color: #ff0099">  206: </span>    <span style="color: #000099">// unit name</span>
<span style="color: #ff0099">  207: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  208: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  209: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  210: </span>
<span style="color: #ff0099">  211: </span>    <span style="color: #000099">// dependencies</span>
<span style="color: #ff0099">  212: </span>    <span style="color: #000099">// all file dependencies are converted for internal use to a path relative to the library</span>
<span style="color: #ff0099">  213: </span>    <span style="color: #000099">// they can be retrieved either in this form or as a full path</span>
<span style="color: #ff0099">  214: </span>
<span style="color: #ff0099">  215: </span>    <span style="color: #000099">// source file dependency</span>
<span style="color: #ff0099">  216: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_source_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  217: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">source_file_present</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  218: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  219: </span>
<span style="color: #ff0099">  220: </span>    <span style="color: #000099">// other file dependencies</span>
<span style="color: #ff0099">  221: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">file_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  222: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">file_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  223: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  224: </span>    <span style="color: #990000">void</span> <span style="color: #000000">file_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  225: </span>
<span style="color: #ff0099">  226: </span>    <span style="color: #000099">// unit dependencies</span>
<span style="color: #ff0099">  227: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  228: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  229: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  230: </span>    <span style="color: #990000">void</span> <span style="color: #000000">unit_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  231: </span>
<span style="color: #ff0099">  232: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  233: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  234: </span>    <span style="color: #990000">void</span> <span style="color: #000000">clear_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  235: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">empty_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  236: </span>
<span style="color: #ff0099">  237: </span>    <span style="color: #000099">// dependency checking</span>
<span style="color: #ff0099">  238: </span>
<span style="color: #ff0099">  239: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">out_of_date</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  240: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">up_to_date</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  241: </span>    <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">out_of_date_reason</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  242: </span>
<span style="color: #ff0099">  243: </span>    <span style="color: #000099">// supplementary data</span>
<span style="color: #ff0099">  244: </span>
<span style="color: #ff0099">  245: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">supplementary_data</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  246: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_supplementary_data</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  247: </span>
<span style="color: #ff0099">  248: </span>    <span style="color: #000099">////////////////////////////////////////</span>
<span style="color: #ff0099">  249: </span>    <span style="color: #000099">// unit data management</span>
<span style="color: #ff0099">  250: </span>
<span style="color: #ff0099">  251: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  252: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  253: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">loaded</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  254: </span>    <span style="color: #990000">void</span> <span style="color: #000000">mark</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  255: </span>
<span style="color: #ff0099">  256: </span>    <span style="color: #000099">// file modified time - only changes after a save</span>
<span style="color: #ff0099">  257: </span>
<span style="color: #ff0099">  258: </span>    <span style="color: #000000">time_t</span> <span style="color: #000000">modified</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  259: </span>
<span style="color: #ff0099">  260: </span>    <span style="color: #000099">////////////////////////////////////////</span>
<span style="color: #ff0099">  261: </span>    <span style="color: #000099">// containing library manager details</span>
<span style="color: #ff0099">  262: </span>
<span style="color: #ff0099">  263: </span>    <span style="color: #000099">// get the owning library</span>
<span style="color: #ff0099">  264: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  265: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  266: </span>
<span style="color: #ff0099">  267: </span>    <span style="color: #000099">// owning library name and path</span>
<span style="color: #ff0099">  268: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  269: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  270: </span>
<span style="color: #ff0099">  271: </span>    <span style="color: #000099">////////////////////////////////////////</span>
<span style="color: #ff0099">  272: </span>    <span style="color: #000099">// error handling - these apply to the last read/write operation</span>
<span style="color: #ff0099">  273: </span>
<span style="color: #ff0099">  274: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">error</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  275: </span>
<span style="color: #ff0099">  276: </span>    <span style="color: #000099">////////////////////////////////////////</span>
<span style="color: #ff0099">  277: </span>    <span style="color: #000099">// functions that customise subclasses of this superclass</span>
<span style="color: #ff0099">  278: </span>    <span style="color: #000099">// You MUST provide at least:</span>
<span style="color: #ff0099">  279: </span>    <span style="color: #000099">//   - read - either read operation can be overloaded</span>
<span style="color: #ff0099">  280: </span>    <span style="color: #000099">//   - write - either write operation can be overloaded</span>
<span style="color: #ff0099">  281: </span>    <span style="color: #000099">//   - clone</span>
<span style="color: #ff0099">  282: </span>
<span style="color: #ff0099">  283: </span>    <span style="color: #000099">// read(filename) is the one actually called to read your data</span>
<span style="color: #ff0099">  284: </span>    <span style="color: #000099">// the default read(filename) simply calls read(istream) to actually read the file</span>
<span style="color: #ff0099">  285: </span>    <span style="color: #000099">// the default read(istream) does nothing but fail by returning false so you must overload one or other</span>
<span style="color: #ff0099">  286: </span>
<span style="color: #ff0099">  287: </span>    <span style="color: #000099">// you can just overload read(istream) if you want to use IOstream, or you</span>
<span style="color: #ff0099">  288: </span>    <span style="color: #000099">// can overload read(filename) to use any I/O system</span>
<span style="color: #ff0099">  289: </span>
<span style="color: #ff0099">  290: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filename</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  291: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">istream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  292: </span>
<span style="color: #ff0099">  293: </span>    <span style="color: #000099">// as above, but for writing the data type</span>
<span style="color: #ff0099">  294: </span>
<span style="color: #ff0099">  295: </span>    <span style="color: #000099">// write(filename) is the one actually called to write your data</span>
<span style="color: #ff0099">  296: </span>    <span style="color: #000099">// the default write(filename) simply calls write(ostream) to actually write the file</span>
<span style="color: #ff0099">  297: </span>    <span style="color: #000099">// the default write(ostream) does nothing but fail by returning false so you must overload one or other</span>
<span style="color: #ff0099">  298: </span>
<span style="color: #ff0099">  299: </span>    <span style="color: #000099">// you can just overload write(ostream) if you want to use IOstream, or you</span>
<span style="color: #ff0099">  300: </span>    <span style="color: #000099">// can overload write(filename) to use any I/O system</span>
<span style="color: #ff0099">  301: </span>
<span style="color: #ff0099">  302: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filename</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  303: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  304: </span>
<span style="color: #ff0099">  305: </span>    <span style="color: #000099">// purge clears any memory associated with the unit - makes the unit unloaded</span>
<span style="color: #ff0099">  306: </span>    <span style="color: #000099">// the default does nothing</span>
<span style="color: #ff0099">  307: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  308: </span>
<span style="color: #ff0099">  309: </span>    <span style="color: #000099">// the clone function creates a new-ed copy of the subclass</span>
<span style="color: #ff0099">  310: </span>    <span style="color: #990000">virtual</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">*</span> <span style="color: #000000">clone</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  311: </span>
<span style="color: #ff0099">  312: </span>    <span style="color: #000099">// the default print routines print header-only information</span>
<span style="color: #ff0099">  313: </span>    <span style="color: #000099">// you can overload these to provide a debug printout of the data structure</span>
<span style="color: #ff0099">  314: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  315: </span>    <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  316: </span>
<span style="color: #ff0099">  317: </span>  <span style="color: #990000">protected</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  318: </span>    <span style="color: #000099">// header file management</span>
<span style="color: #ff0099">  319: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">filename</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  320: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">header_filename</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  321: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">write_header</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  322: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read_header</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  323: </span>
<span style="color: #ff0099">  324: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  325: </span>    <span style="color: #000099">// header fields</span>
<span style="color: #ff0099">  326: </span>    <span style="color: #000000">lm_unit_name</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>            <span style="color: #000099">// name</span>
<span style="color: #ff0099">  327: </span>    <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">m_dependencies</span><span style="color: #330033">;</span> <span style="color: #000099">// file and unit dependencies</span>
<span style="color: #ff0099">  328: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_supplement</span><span style="color: #330033">;</span>       <span style="color: #000099">// supplementary data</span>
<span style="color: #ff0099">  329: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_header_modified</span><span style="color: #330033">;</span>         <span style="color: #000099">// header modified</span>
<span style="color: #ff0099">  330: </span>
<span style="color: #ff0099">  331: </span>    <span style="color: #000099">// internal fields</span>
<span style="color: #ff0099">  332: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_loaded</span><span style="color: #330033">;</span>                  <span style="color: #000099">// loaded flag</span>
<span style="color: #ff0099">  333: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_marked</span><span style="color: #330033">;</span>                  <span style="color: #000099">// mark - determines whether the unit needs saving</span>
<span style="color: #ff0099">  334: </span>
<span style="color: #ff0099">  335: </span>    <span style="color: #000099">// library manager fields</span>
<span style="color: #ff0099">  336: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">m_library</span><span style="color: #330033">;</span>          <span style="color: #000099">// parent library</span>
<span style="color: #ff0099">  337: </span>
<span style="color: #ff0099">  338: </span>    <span style="color: #000099">// error handling fields</span>
<span style="color: #ff0099">  339: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_error</span><span style="color: #330033">;</span>                    <span style="color: #000099">// error flag if load or save fails - from IOstream</span>
<span style="color: #ff0099">  340: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  341: </span>
<span style="color: #ff0099">  342: </span>  <span style="color: #000099">// Iostream print calls the short print method</span>
<span style="color: #ff0099">  343: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">&amp;</span> <span style="color: #000000">u</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  344: </span>
<span style="color: #ff0099">  345: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  346: </span>  <span style="color: #000099">// other types used in the library manager</span>
<span style="color: #ff0099">  347: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  348: </span>
<span style="color: #ff0099">  349: </span>  <span style="color: #000099">// user types</span>
<span style="color: #ff0099">  350: </span>
<span style="color: #ff0099">  351: </span>  <span style="color: #990000">typedef</span> <span style="color: #000000">smart_ptr_nocopy</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit</span><span style="color: #330033">&gt;</span> <span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  352: </span>  <span style="color: #990000">typedef</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">*</span> <span style="color: #330033">(</span><span style="color: #330033">*</span><span style="color: #000000">lm_create_callback</span><span style="color: #330033">)</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">,</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">parent_library</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  353: </span>
<span style="color: #ff0099">  354: </span>  <span style="color: #000099">// internal types used in the library manager but made global because they are shared</span>
<span style="color: #ff0099">  355: </span>
<span style="color: #ff0099">  356: </span>  <span style="color: #990000">struct</span> <span style="color: #000000">lm_callback_entry</span>
<span style="color: #ff0099">  357: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">  358: </span>    <span style="color: #000000">lm_create_callback</span> <span style="color: #000000">m_callback</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  359: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_description</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  360: </span>    <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">m_type_data</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  361: </span>
<span style="color: #ff0099">  362: </span>    <span style="color: #000000">lm_callback_entry</span><span style="color: #330033">(</span><span style="color: #000000">lm_create_callback</span> <span style="color: #000000">callback</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">description</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #330033">:</span>
<span style="color: #ff0099">  363: </span>      <span style="color: #000000">m_callback</span><span style="color: #330033">(</span><span style="color: #000000">callback</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #000000">m_description</span><span style="color: #330033">(</span><span style="color: #000000">description</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #000000">m_type_data</span><span style="color: #330033">(</span><span style="color: #000000">type_data</span><span style="color: #330033">)</span> <span style="color: #330033">{</span><span style="color: #330033">}</span>
<span style="color: #ff0099">  364: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  365: </span>
<span style="color: #ff0099">  366: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  367: </span>  <span style="color: #000099">// Library</span>
<span style="color: #ff0099">  368: </span>  <span style="color: #000099">// Must be contained in a library_manager</span>
<span style="color: #ff0099">  369: </span>  <span style="color: #000099">// Manages objects of class lm_unit and its subclasses</span>
<span style="color: #ff0099">  370: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  371: </span>
<span style="color: #ff0099">  372: </span>  <span style="color: #990000">class</span> <span style="color: #000000">lm_library</span>
<span style="color: #ff0099">  373: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">  374: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  375: </span>    <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">library_manager</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  376: </span>    <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  377: </span>
<span style="color: #ff0099">  378: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  379: </span>    <span style="color: #000099">// constructors/destructor - lm_library should only ever be constructed by library_manager</span>
<span style="color: #ff0099">  380: </span>
<span style="color: #ff0099">  381: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">(</span><span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">manager</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  382: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  383: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  384: </span>    <span style="color: #330033">~</span><span style="color: #000000">lm_library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  385: </span>
<span style="color: #ff0099">  386: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  387: </span>
<span style="color: #ff0099">  388: </span>    <span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  389: </span>    <span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  390: </span>
<span style="color: #ff0099">  391: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  392: </span>    <span style="color: #000099">// initialisers</span>
<span style="color: #ff0099">  393: </span>
<span style="color: #ff0099">  394: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  395: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">open</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  396: </span>
<span style="color: #ff0099">  397: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  398: </span>    <span style="color: #000099">// management of types</span>
<span style="color: #ff0099">  399: </span>
<span style="color: #ff0099">  400: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  401: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load_types</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  402: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">remove_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  403: </span>
<span style="color: #ff0099">  404: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  405: </span>    <span style="color: #000099">// whole library operations</span>
<span style="color: #ff0099">  406: </span>
<span style="color: #ff0099">  407: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  408: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  409: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  410: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">close</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  411: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  412: </span>
<span style="color: #ff0099">  413: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  414: </span>    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  415: </span>
<span style="color: #ff0099">  416: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  417: </span>    <span style="color: #000099">// managing read/write status</span>
<span style="color: #ff0099">  418: </span>
<span style="color: #ff0099">  419: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">set_read_write</span><span style="color: #330033">(</span><span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  420: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">set_writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  421: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">set_read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  422: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  423: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  424: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">os_writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  425: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">os_read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  426: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">lm_writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  427: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">lm_read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  428: </span>
<span style="color: #ff0099">  429: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  430: </span>    <span style="color: #000099">// unit management</span>
<span style="color: #ff0099">  431: </span>
<span style="color: #ff0099">  432: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  433: </span>    <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  434: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">loaded</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  435: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  436: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  437: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  438: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  439: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">mark</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  440: </span>    <span style="color: #000000">time_t</span> <span style="color: #000000">modified</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  441: </span>
<span style="color: #ff0099">  442: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase_by_source</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  443: </span>
<span style="color: #ff0099">  444: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  445: </span>    <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  446: </span>
<span style="color: #ff0099">  447: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  448: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  449: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  450: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  451: </span>
<span style="color: #ff0099">  452: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  453: </span>    <span style="color: #000099">// dependency checking</span>
<span style="color: #ff0099">  454: </span>
<span style="color: #ff0099">  455: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">out_of_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  456: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">up_to_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  457: </span>    <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">out_of_date_reason</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  458: </span>
<span style="color: #ff0099">  459: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">pair</span><span style="color: #330033">&lt;</span><span style="color: #990000">bool</span><span style="color: #330033">,</span><span style="color: #990000">unsigned</span><span style="color: #330033">&gt;</span> <span style="color: #000000">tidy</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  460: </span>
<span style="color: #ff0099">  461: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  462: </span>    <span style="color: #000099">// do-everything print function</span>
<span style="color: #ff0099">  463: </span>
<span style="color: #ff0099">  464: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">pretty_print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span>
<span style="color: #ff0099">  465: </span>                      <span style="color: #990000">bool</span> <span style="color: #000000">print_units</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">,</span>                       <span style="color: #000099">// print the unit names not just the library names</span>
<span style="color: #ff0099">  466: </span>                      <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span> <span style="color: #000099">// print just this type ("" means all)</span>
<span style="color: #ff0099">  467: </span>
<span style="color: #ff0099">  468: </span>    <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  469: </span>    <span style="color: #000099">// diagnostic print routines</span>
<span style="color: #ff0099">  470: </span>
<span style="color: #ff0099">  471: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  472: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  473: </span>
<span style="color: #ff0099">  474: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  475: </span>
<span style="color: #ff0099">  476: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">map</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">,</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span><span style="color: #330033">::</span><span style="color: #000000">iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  477: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">map</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">,</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span><span style="color: #330033">::</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  478: </span>
<span style="color: #ff0099">  479: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>                         <span style="color: #000099">// name</span>
<span style="color: #ff0099">  480: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_path</span><span style="color: #330033">;</span>                         <span style="color: #000099">// path</span>
<span style="color: #ff0099">  481: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_writable</span><span style="color: #330033">;</span>                            <span style="color: #000099">// writable</span>
<span style="color: #ff0099">  482: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">map</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">,</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_units</span><span style="color: #330033">;</span> <span style="color: #000099">// units</span>
<span style="color: #ff0099">  483: </span>    <span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">m_manager</span><span style="color: #330033">;</span>                 <span style="color: #000099">// parent library manager</span>
<span style="color: #ff0099">  484: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  485: </span>
<span style="color: #ff0099">  486: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span> <span style="color: #000000">lib</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  487: </span>
<span style="color: #ff0099">  488: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  489: </span>  <span style="color: #000099">// Library Manager</span>
<span style="color: #ff0099">  490: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  491: </span>
<span style="color: #ff0099">  492: </span>  <span style="color: #990000">class</span> <span style="color: #000000">library_manager</span>
<span style="color: #ff0099">  493: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">  494: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  495: </span>    <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_library</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  496: </span>    <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  497: </span>
<span style="color: #ff0099">  498: </span>    <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  499: </span>    <span style="color: #000099">// static functions allow you to test whether a directory is a library before opening it</span>
<span style="color: #ff0099">  500: </span>    <span style="color: #000099">// you can also find the library's name without opening it</span>
<span style="color: #ff0099">  501: </span>
<span style="color: #ff0099">  502: </span>    <span style="color: #990000">static</span> <span style="color: #990000">bool</span> <span style="color: #000000">is_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  503: </span>    <span style="color: #990000">static</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">library_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  504: </span>
<span style="color: #ff0099">  505: </span>    <span style="color: #000099">// non-static forms test for libraries with the same owner as the library manager</span>
<span style="color: #ff0099">  506: </span>
<span style="color: #ff0099">  507: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">is_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  508: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">library_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  509: </span>
<span style="color: #ff0099">  510: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  511: </span>    <span style="color: #000099">// tructors</span>
<span style="color: #ff0099">  512: </span>
<span style="color: #ff0099">  513: </span>    <span style="color: #990000">explicit</span> <span style="color: #000000">library_manager</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">owner</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">library_case</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">unit_case</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  514: </span>    <span style="color: #330033">~</span><span style="color: #000000">library_manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  515: </span>
<span style="color: #ff0099">  516: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  517: </span>    <span style="color: #000099">// case sensitivity</span>
<span style="color: #ff0099">  518: </span>
<span style="color: #ff0099">  519: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">library_case</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  520: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_library_case</span><span style="color: #330033">(</span><span style="color: #990000">bool</span> <span style="color: #000000">library_case</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  521: </span>
<span style="color: #ff0099">  522: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">unit_case</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  523: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_unit_case</span><span style="color: #330033">(</span><span style="color: #990000">bool</span> <span style="color: #000000">library_case</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  524: </span>
<span style="color: #ff0099">  525: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  526: </span>    <span style="color: #000099">// type handling</span>
<span style="color: #ff0099">  527: </span>    <span style="color: #000099">// only units of types added in this way will be recognised</span>
<span style="color: #ff0099">  528: </span>
<span style="color: #ff0099">  529: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">,</span>
<span style="color: #ff0099">  530: </span>                  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">description</span><span style="color: #330033">,</span>
<span style="color: #ff0099">  531: </span>                  <span style="color: #000000">lm_create_callback</span> <span style="color: #000000">fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span>
<span style="color: #ff0099">  532: </span>                  <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  533: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">remove_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  534: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">types</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  535: </span>
<span style="color: #ff0099">  536: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">description</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  537: </span>    <span style="color: #000000">lm_create_callback</span> <span style="color: #000000">callback</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  538: </span>    <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  539: </span>
<span style="color: #ff0099">  540: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  541: </span>    <span style="color: #000099">// Library mappings</span>
<span style="color: #ff0099">  542: </span>    <span style="color: #000099">// The library manager implements two different styles of library mappings</span>
<span style="color: #ff0099">  543: </span>    <span style="color: #000099">//   - mapping file</span>
<span style="color: #ff0099">  544: </span>    <span style="color: #000099">//   - ini file</span>
<span style="color: #ff0099">  545: </span>    <span style="color: #000099">// mapping file handling uses a simple text file to store the mappings in an internally-defined format</span>
<span style="color: #ff0099">  546: </span>    <span style="color: #000099">// ini file handling stores library mappings using the ini_manager component</span>
<span style="color: #ff0099">  547: </span>    <span style="color: #000099">// These modes are switched on by simply specifying a mapping file or an ini file to hold the mappings</span>
<span style="color: #ff0099">  548: </span>
<span style="color: #ff0099">  549: </span>    <span style="color: #000099">// mapping file methods</span>
<span style="color: #ff0099">  550: </span>
<span style="color: #ff0099">  551: </span>    <span style="color: #000099">// set but do not load - use this when you want to create a new mapping file</span>
<span style="color: #ff0099">  552: </span>    <span style="color: #990000">void</span> <span style="color: #000000">set_mapping_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">mapping_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  553: </span>    <span style="color: #000099">// set and load - use this with an existing mapping file</span>
<span style="color: #ff0099">  554: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load_mappings</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">mapping_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  555: </span>    <span style="color: #000099">// return the mapping file string</span>
<span style="color: #ff0099">  556: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">mapping_file</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  557: </span>
<span style="color: #ff0099">  558: </span>    <span style="color: #000099">// ini file methods - the ini manager must be pre-loaded with the list of ini files to manage</span>
<span style="color: #ff0099">  559: </span>
<span style="color: #ff0099">  560: </span>    <span style="color: #000099">// set and load - this will create the relevant sections in the local ini file if not present already</span>
<span style="color: #ff0099">  561: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">set_ini_manager</span><span style="color: #330033">(</span><span style="color: #000000">ini_manager</span><span style="color: #330033">*</span> <span style="color: #000000">ini_files</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">work_section</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  562: </span>    <span style="color: #000000">ini_manager</span><span style="color: #330033">*</span> <span style="color: #000000">get_ini_manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  563: </span>
<span style="color: #ff0099">  564: </span>    <span style="color: #000099">// save to the library mapping handler, whichever kind it is</span>
<span style="color: #ff0099">  565: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save_mappings</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  566: </span>
<span style="color: #ff0099">  567: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  568: </span>    <span style="color: #000099">// library management</span>
<span style="color: #ff0099">  569: </span>
<span style="color: #ff0099">  570: </span>    <span style="color: #000099">// operations on a single library</span>
<span style="color: #ff0099">  571: </span>    <span style="color: #000099">// test whether a named library exists</span>
<span style="color: #ff0099">  572: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  573: </span>    <span style="color: #000099">// create a new libarry in the specified directory</span>
<span style="color: #ff0099">  574: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">writable</span> <span style="color: #330033">=</span> <span style="color: #990000">true</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  575: </span>    <span style="color: #000099">// open an existing library</span>
<span style="color: #ff0099">  576: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">open</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  577: </span>    <span style="color: #000099">// load all units in the library</span>
<span style="color: #ff0099">  578: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  579: </span>    <span style="color: #000099">// save all marked units in the library</span>
<span style="color: #ff0099">  580: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  581: </span>    <span style="color: #000099">// purge all loaded units in the library</span>
<span style="color: #ff0099">  582: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  583: </span>    <span style="color: #000099">// close the library - remove it from the manager but leave on disk</span>
<span style="color: #ff0099">  584: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">close</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  585: </span>    <span style="color: #000099">// erase the library - delete the directory and remove the library from the manager</span>
<span style="color: #ff0099">  586: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  587: </span>
<span style="color: #ff0099">  588: </span>    <span style="color: #000099">// operations on all libraries - as above but applied to all the libraries in the manager</span>
<span style="color: #ff0099">  589: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  590: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  591: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  592: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">close</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  593: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  594: </span>
<span style="color: #ff0099">  595: </span>    <span style="color: #000099">// get name and path of a library - name can differ in case if the library manager is case-insensitive</span>
<span style="color: #ff0099">  596: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  597: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">path</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  598: </span>
<span style="color: #ff0099">  599: </span>    <span style="color: #000099">// control and test read/write status</span>
<span style="color: #ff0099">  600: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">set_writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  601: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">set_read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  602: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  603: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  604: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">os_writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  605: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">os_read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  606: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">lm_writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  607: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">lm_read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  608: </span>
<span style="color: #ff0099">  609: </span>    <span style="color: #000099">// find a library in the manager - returns null if not found</span>
<span style="color: #ff0099">  610: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  611: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  612: </span>
<span style="color: #ff0099">  613: </span>    <span style="color: #000099">// get the set of all library names</span>
<span style="color: #ff0099">  614: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  615: </span>    <span style="color: #000099">// get the set of all libraries</span>
<span style="color: #ff0099">  616: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  617: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_library</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  618: </span>
<span style="color: #ff0099">  619: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  620: </span>    <span style="color: #000099">// current library management</span>
<span style="color: #ff0099">  621: </span>
<span style="color: #ff0099">  622: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">setwork</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  623: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">unsetwork</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  624: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">work</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  625: </span>    <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">work</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  626: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">work_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  627: </span>
<span style="color: #ff0099">  628: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  629: </span>    <span style="color: #000099">// unit management within a library</span>
<span style="color: #ff0099">  630: </span>    <span style="color: #000099">// Note: you can also manipulate the library class through a handle returned by find() or handles()</span>
<span style="color: #ff0099">  631: </span>
<span style="color: #ff0099">  632: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  633: </span>    <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  634: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">loaded</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  635: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  636: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  637: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  638: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  639: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">mark</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  640: </span>    <span style="color: #000000">time_t</span> <span style="color: #000000">modified</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  641: </span>
<span style="color: #ff0099">  642: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase_by_source</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  643: </span>
<span style="color: #ff0099">  644: </span>    <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  645: </span>    <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  646: </span>
<span style="color: #ff0099">  647: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  648: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  649: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  650: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  651: </span>
<span style="color: #ff0099">  652: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  653: </span>    <span style="color: #000099">// dependency checking</span>
<span style="color: #ff0099">  654: </span>
<span style="color: #ff0099">  655: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">out_of_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  656: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">up_to_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  657: </span>    <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">out_of_date_reason</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  658: </span>
<span style="color: #ff0099">  659: </span>    <span style="color: #000099">// delete out of date units from a library or all libraries</span>
<span style="color: #ff0099">  660: </span>    <span style="color: #000099">// return the number of units tidied and a flag to say whether all units were successfully tidied</span>
<span style="color: #ff0099">  661: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">pair</span><span style="color: #330033">&lt;</span><span style="color: #990000">bool</span><span style="color: #330033">,</span><span style="color: #990000">unsigned</span><span style="color: #330033">&gt;</span> <span style="color: #000000">tidy</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  662: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">pair</span><span style="color: #330033">&lt;</span><span style="color: #990000">bool</span><span style="color: #330033">,</span><span style="color: #990000">unsigned</span><span style="color: #330033">&gt;</span> <span style="color: #000000">tidy</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  663: </span>
<span style="color: #ff0099">  664: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  665: </span>    <span style="color: #000099">// do-everything print routine!</span>
<span style="color: #ff0099">  666: </span>
<span style="color: #ff0099">  667: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">pretty_print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span>
<span style="color: #ff0099">  668: </span>                      <span style="color: #990000">bool</span> <span style="color: #000000">print_units</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">,</span>                       <span style="color: #000099">// print the unit names not just the library names</span>
<span style="color: #ff0099">  669: </span>                      <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">,</span>     <span style="color: #000099">// print just the specified library ("" means all)</span>
<span style="color: #ff0099">  670: </span>                      <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span> <span style="color: #000099">// print just this type ("" means all)</span>
<span style="color: #ff0099">  671: </span>
<span style="color: #ff0099">  672: </span>    <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  673: </span>    <span style="color: #000099">// diagnostic print routines</span>
<span style="color: #ff0099">  674: </span>
<span style="color: #ff0099">  675: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  676: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  677: </span>
<span style="color: #ff0099">  678: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  679: </span>    <span style="color: #000099">// internals</span>
<span style="color: #ff0099">  680: </span>
<span style="color: #ff0099">  681: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  682: </span>    <span style="color: #000099">// NOT a copyable object</span>
<span style="color: #ff0099">  683: </span>    <span style="color: #000000">library_manager</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  684: </span>    <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  685: </span>
<span style="color: #ff0099">  686: </span>  <span style="color: #990000">protected</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  687: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">list</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_library</span><span style="color: #330033">&gt;</span><span style="color: #330033">::</span><span style="color: #000000">iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  688: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">list</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_library</span><span style="color: #330033">&gt;</span><span style="color: #330033">::</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  689: </span>
<span style="color: #ff0099">  690: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_owner</span><span style="color: #330033">;</span>                               <span style="color: #000099">// owner application name</span>
<span style="color: #ff0099">  691: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_mapping_file</span><span style="color: #330033">;</span>                        <span style="color: #000099">// mapping file method of library management</span>
<span style="color: #ff0099">  692: </span>    <span style="color: #000000">ini_manager</span><span style="color: #330033">*</span> <span style="color: #000000">m_ini_files</span><span style="color: #330033">;</span>                          <span style="color: #000099">// ini manager method of library management</span>
<span style="color: #ff0099">  693: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_ini_section</span><span style="color: #330033">;</span>                         <span style="color: #000099">// ini manager method of library management</span>
<span style="color: #ff0099">  694: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_ini_work</span><span style="color: #330033">;</span>                            <span style="color: #000099">// ini manager method of library management</span>
<span style="color: #ff0099">  695: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">list</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_library</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_libraries</span><span style="color: #330033">;</span>                 <span style="color: #000099">// libraries</span>
<span style="color: #ff0099">  696: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_work</span><span style="color: #330033">;</span>                                <span style="color: #000099">// work library</span>
<span style="color: #ff0099">  697: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">map</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">,</span><span style="color: #000000">lm_callback_entry</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_callbacks</span><span style="color: #330033">;</span> <span style="color: #000099">// callbacks</span>
<span style="color: #ff0099">  698: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_library_case</span><span style="color: #330033">;</span>                               <span style="color: #000099">// case sensitivity for library names</span>
<span style="color: #ff0099">  699: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">m_unit_case</span><span style="color: #330033">;</span>                                  <span style="color: #000099">// case sensitivity for unit names</span>
<span style="color: #ff0099">  700: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  701: </span>
<span style="color: #ff0099">  702: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span> <span style="color: #000000">libraries</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  703: </span>
<span style="color: #ff0099">  704: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  705: </span>
<span style="color: #ff0099">  706: </span><span style="color: #330033">}</span> <span style="color: #000099">// end namespace stlplus</span>
<span style="color: #ff0099">  707: </span>
<span style="color: #ff0099">  708: </span><span style="color: #990000">#endif</span>
</pre>
</body>
</html>
