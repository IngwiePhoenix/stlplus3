<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>subsystems/ini_manager.hpp</title>
<meta http-equiv="generator" content="ccolour C++ colouriser by Andy Rushton">
</head>
<body lang="en">
<h1>subsystems/ini_manager.hpp</h1>
<pre style="background-color: #ffffff">
<span style="color: #ff0099">    1: </span><span style="color: #990000">#ifndef</span> <span style="color: #000000">STLPLUS_INI_MANAGER</span>
<span style="color: #ff0099">    2: </span><span style="color: #990000">#define</span> <span style="color: #000000">STLPLUS_INI_MANAGER</span>
<span style="color: #ff0099">    3: </span><span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">    4: </span>
<span style="color: #ff0099">    5: </span><span style="color: #000099">//   Author:    Andy Rushton</span>
<span style="color: #ff0099">    6: </span><span style="color: #000099">//   Copyright: (c) Southampton University 1999-2004</span>
<span style="color: #ff0099">    7: </span><span style="color: #000099">//              (c) Andy Rushton           2004 onwards</span>
<span style="color: #ff0099">    8: </span><span style="color: #000099">//   License:   BSD License, see ../docs/license.html</span>
<span style="color: #ff0099">    9: </span>
<span style="color: #ff0099">   10: </span><span style="color: #000099">//   A subsystem for managing INI (i.e. .ini) files</span>
<span style="color: #ff0099">   11: </span><span style="color: #000099">//   An INI file has the following format</span>
<span style="color: #ff0099">   12: </span>
<span style="color: #ff0099">   13: </span><span style="color: #000099">//     file           ::= header { section }*</span>
<span style="color: #ff0099">   14: </span><span style="color: #000099">//     header         ::= { comment | blank }*</span>
<span style="color: #ff0099">   15: </span><span style="color: #000099">//     section        ::= section_header { declaration | comment | blank }*</span>
<span style="color: #ff0099">   16: </span><span style="color: #000099">//     section_header ::= '[' title ']' '\n'</span>
<span style="color: #ff0099">   17: </span><span style="color: #000099">//     declaration    ::= variable '=' value '\n'</span>
<span style="color: #ff0099">   18: </span><span style="color: #000099">//     comment        ::= ';' text '\n'</span>
<span style="color: #ff0099">   19: </span><span style="color: #000099">//     blank          ::= '\n'</span>
<span style="color: #ff0099">   20: </span><span style="color: #000099">//     title          ::= [~']']*</span>
<span style="color: #ff0099">   21: </span><span style="color: #000099">//     variable       ::= [~'=']*</span>
<span style="color: #ff0099">   22: </span><span style="color: #000099">//     value          ::= .*</span>
<span style="color: #ff0099">   23: </span><span style="color: #000099">//     text           ::= .*</span>
<span style="color: #ff0099">   24: </span>
<span style="color: #ff0099">   25: </span><span style="color: #000099">//   Whitespace is trimmed from the leading and trailing ends of title, variable and value</span>
<span style="color: #ff0099">   26: </span><span style="color: #000099">//   Note: a header is represented internally as a Clint section (i.e. a section with no name)</span>
<span style="color: #ff0099">   27: </span>
<span style="color: #ff0099">   28: </span><span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   29: </span><span style="color: #990000">#include</span> <span style="color: #009900">"subsystems_fixes.hpp"</span>
<span style="color: #ff0099">   30: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;vector&gt;</span>
<span style="color: #ff0099">   31: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;string&gt;</span>
<span style="color: #ff0099">   32: </span><span style="color: #990000">#include</span> <span style="color: #009900">&lt;iostream&gt;</span>
<span style="color: #ff0099">   33: </span>
<span style="color: #ff0099">   34: </span><span style="color: #990000">namespace</span> <span style="color: #000000">stlplus</span>
<span style="color: #ff0099">   35: </span><span style="color: #330033">{</span>
<span style="color: #ff0099">   36: </span>
<span style="color: #ff0099">   37: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   38: </span>  <span style="color: #000099">// Internals</span>
<span style="color: #ff0099">   39: </span>
<span style="color: #ff0099">   40: </span>  <span style="color: #990000">class</span> <span style="color: #000000">ini_manager_body</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   41: </span>
<span style="color: #ff0099">   42: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   43: </span>  <span style="color: #000099">// Ini-file manager class</span>
<span style="color: #ff0099">   44: </span>
<span style="color: #ff0099">   45: </span>  <span style="color: #990000">class</span> <span style="color: #000000">ini_manager</span>
<span style="color: #ff0099">   46: </span>  <span style="color: #330033">{</span>
<span style="color: #ff0099">   47: </span>  <span style="color: #990000">public</span><span style="color: #330033">:</span>
<span style="color: #ff0099">   48: </span>
<span style="color: #ff0099">   49: </span>    <span style="color: #000000">ini_manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   50: </span>
<span style="color: #ff0099">   51: </span>    <span style="color: #990000">explicit</span> <span style="color: #000000">ini_manager</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filenames</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   52: </span>
<span style="color: #ff0099">   53: </span>    <span style="color: #000000">ini_manager</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">ini_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   54: </span>    <span style="color: #000000">ini_manager</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">ini_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   55: </span>
<span style="color: #ff0099">   56: </span>    <span style="color: #330033">~</span><span style="color: #000000">ini_manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   57: </span>
<span style="color: #ff0099">   58: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   59: </span>    <span style="color: #000099">// file management</span>
<span style="color: #ff0099">   60: </span>
<span style="color: #ff0099">   61: </span>    <span style="color: #000099">// add files starting with the most local file (e.g. the current project) which has depth 0</span>
<span style="color: #ff0099">   62: </span>    <span style="color: #000099">// and working back to the most global (e.g. the installation settings) which has a depth of size()-1</span>
<span style="color: #ff0099">   63: </span>    <span style="color: #000099">// This does nothing if the file has already been loaded - it is not permitted to manage the same file twice.</span>
<span style="color: #ff0099">   64: </span>    <span style="color: #000099">// Returns true if the file loaded okay or was already loaded (it is counted as successful if the file did</span>
<span style="color: #ff0099">   65: </span>    <span style="color: #000099">// not exist, only read errors cause a failure)</span>
<span style="color: #ff0099">   66: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filename</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   67: </span>
<span style="color: #ff0099">   68: </span>    <span style="color: #000099">// as above, returns false if *none* of the files were added</span>
<span style="color: #ff0099">   69: </span>    <span style="color: #000099">// filenames[0] is the local file, and so on</span>
<span style="color: #ff0099">   70: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_files</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filenames</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   71: </span>
<span style="color: #ff0099">   72: </span>    <span style="color: #000099">// saves modified ini files - returns true if all modified files were written successfully</span>
<span style="color: #ff0099">   73: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   74: </span>
<span style="color: #ff0099">   75: </span>    <span style="color: #000099">// get the number of files being managed</span>
<span style="color: #ff0099">   76: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   77: </span>
<span style="color: #ff0099">   78: </span>    <span style="color: #000099">// get the ini filename associated with a depth</span>
<span style="color: #ff0099">   79: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">filename</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   80: </span>
<span style="color: #ff0099">   81: </span>    <span style="color: #000099">// test whether a file in the ini manager is writable</span>
<span style="color: #ff0099">   82: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   83: </span>
<span style="color: #ff0099">   84: </span>    <span style="color: #000099">// test whether a file is empty</span>
<span style="color: #ff0099">   85: </span>    <span style="color: #000099">// An ini file is considered empty if it has no named sections and the header is empty or missing</span>
<span style="color: #ff0099">   86: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">empty</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   87: </span>
<span style="color: #ff0099">   88: </span>    <span style="color: #000099">// erase the ini file from the ini manager and from the disk</span>
<span style="color: #ff0099">   89: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   90: </span>
<span style="color: #ff0099">   91: </span>    <span style="color: #000099">// remove the file from the ini manager but do not erase it from the disk</span>
<span style="color: #ff0099">   92: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">remove</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   93: </span>
<span style="color: #ff0099">   94: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">   95: </span>    <span style="color: #000099">// section management</span>
<span style="color: #ff0099">   96: </span>
<span style="color: #ff0099">   97: </span>    <span style="color: #000099">// returns the union of all section names in all of the ini files</span>
<span style="color: #ff0099">   98: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">section_names</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">   99: </span>
<span style="color: #ff0099">  100: </span>    <span style="color: #000099">// returns the section names in one of the ini files</span>
<span style="color: #ff0099">  101: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">section_names</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  102: </span>
<span style="color: #ff0099">  103: </span>    <span style="color: #000099">// tests whether a section is found in any of the ini files</span>
<span style="color: #ff0099">  104: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">section_exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">title</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  105: </span>
<span style="color: #ff0099">  106: </span>    <span style="color: #000099">// tests whether the section is found in the specific ini file</span>
<span style="color: #ff0099">  107: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">section_exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">title</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  108: </span>
<span style="color: #ff0099">  109: </span>    <span style="color: #000099">// adds a section to the specified ini file - does nothing if it is already present</span>
<span style="color: #ff0099">  110: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_section</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  111: </span>
<span style="color: #ff0099">  112: </span>    <span style="color: #000099">// test whether a section is empty</span>
<span style="color: #ff0099">  113: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">empty_section</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  114: </span>
<span style="color: #ff0099">  115: </span>    <span style="color: #000099">// removes a section from the specified ini file if it exists there but cannot remove it from any other file</span>
<span style="color: #ff0099">  116: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase_section</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  117: </span>
<span style="color: #ff0099">  118: </span>    <span style="color: #000099">// removes all the contents of a section from the specified ini file but keeps the empty section</span>
<span style="color: #ff0099">  119: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">clear_section</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  120: </span>
<span style="color: #ff0099">  121: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  122: </span>    <span style="color: #000099">// variable management</span>
<span style="color: #ff0099">  123: </span>
<span style="color: #ff0099">  124: </span>    <span style="color: #000099">// test whether a variable exists in any of the ini files</span>
<span style="color: #ff0099">  125: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">variable_exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  126: </span>
<span style="color: #ff0099">  127: </span>    <span style="color: #000099">// test whether a variable exists in specified ini file</span>
<span style="color: #ff0099">  128: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">variable_exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  129: </span>
<span style="color: #ff0099">  130: </span>    <span style="color: #000099">// get the union of all variables declared in all ini files</span>
<span style="color: #ff0099">  131: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">variable_names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  132: </span>
<span style="color: #ff0099">  133: </span>    <span style="color: #000099">// get the set of all varaibale names from one file</span>
<span style="color: #ff0099">  134: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">variable_names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  135: </span>
<span style="color: #ff0099">  136: </span>    <span style="color: #000099">// get the depth of the first ini file to define a variable</span>
<span style="color: #ff0099">  137: </span>    <span style="color: #000099">// returns 0 if defined in the local ini file, etc. Returns (unsigned)-1 if the variable doesn't exist</span>
<span style="color: #ff0099">  138: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">variable_depth</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  139: </span>
<span style="color: #ff0099">  140: </span>    <span style="color: #000099">// get the filename that first defines the variable</span>
<span style="color: #ff0099">  141: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable_filename</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  142: </span>    <span style="color: #000099">// ditto for its linenumber within that file</span>
<span style="color: #ff0099">  143: </span>    <span style="color: #990000">unsigned</span> <span style="color: #000000">variable_linenumber</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  144: </span>
<span style="color: #ff0099">  145: </span>    <span style="color: #000099">// get the value of a variable as a single unprocessed string</span>
<span style="color: #ff0099">  146: </span>    <span style="color: #000099">// if the variable does not exist the string will be empty, but beware that</span>
<span style="color: #ff0099">  147: </span>    <span style="color: #000099">// you also get an empty string if a variable exists but has no value</span>
<span style="color: #ff0099">  148: </span>    <span style="color: #000099">// you can differentiate between the two cases by using variable_exists_all above</span>
<span style="color: #ff0099">  149: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable_value</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  150: </span>
<span style="color: #ff0099">  151: </span>    <span style="color: #000099">// get the value from the specified file</span>
<span style="color: #ff0099">  152: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable_value</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  153: </span>
<span style="color: #ff0099">  154: </span>    <span style="color: #000099">// get the value of a variable as a processed string</span>
<span style="color: #ff0099">  155: </span>    <span style="color: #000099">// processing splits the value at commas and furthermore supports quoted strings (so that values can contain commas for example)</span>
<span style="color: #ff0099">  156: </span>    <span style="color: #000099">// quoted strings are dequoted before they are added to the result</span>
<span style="color: #ff0099">  157: </span>    <span style="color: #000099">// the result is a vector of dequoted strings, one per value in the comma-separated list</span>
<span style="color: #ff0099">  158: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">variable_values</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  159: </span>
<span style="color: #ff0099">  160: </span>    <span style="color: #000099">// get the processed variable from the specified file</span>
<span style="color: #ff0099">  161: </span>    <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">variable_values</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">variable</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  162: </span>
<span style="color: #ff0099">  163: </span>    <span style="color: #000099">// add a variable to the specified file</span>
<span style="color: #ff0099">  164: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_variable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">variable</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">value</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  165: </span>
<span style="color: #ff0099">  166: </span>    <span style="color: #000099">// add a variable as a processed string</span>
<span style="color: #ff0099">  167: </span>    <span style="color: #000099">// processing means that the values in the string vector are converted into a comma-separated list</span>
<span style="color: #ff0099">  168: </span>    <span style="color: #000099">// values containing reserved characters are automatically quoted - so you should not even try to quote them yourself</span>
<span style="color: #ff0099">  169: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_variable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">variable</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">values</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  170: </span>
<span style="color: #ff0099">  171: </span>    <span style="color: #000099">// erase a variable from the specified file</span>
<span style="color: #ff0099">  172: </span>    <span style="color: #000099">// this does not remove the variable from other ini files, so the variable may still exist</span>
<span style="color: #ff0099">  173: </span>    <span style="color: #000099">// to mask a global variable, set the variable to an empty string instead</span>
<span style="color: #ff0099">  174: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">erase_variable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">variable</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  175: </span>
<span style="color: #ff0099">  176: </span>    <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  177: </span>    <span style="color: #000099">// sundry line-entry management</span>
<span style="color: #ff0099">  178: </span>
<span style="color: #ff0099">  179: </span>    <span style="color: #000099">// add a comment to the specified ini file</span>
<span style="color: #ff0099">  180: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_comment</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">comment</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  181: </span>
<span style="color: #ff0099">  182: </span>    <span style="color: #000099">// add a blank line to the specified ini file</span>
<span style="color: #ff0099">  183: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">add_blank</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">section</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">depth</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  184: </span>
<span style="color: #ff0099">  185: </span>    <span style="color: #990000">bool</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  186: </span>
<span style="color: #ff0099">  187: </span>  <span style="color: #990000">private</span><span style="color: #330033">:</span>
<span style="color: #ff0099">  188: </span>    <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">ini_manager_body</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  189: </span>    <span style="color: #000000">ini_manager_body</span><span style="color: #330033">*</span> <span style="color: #000000">m_body</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  190: </span>  <span style="color: #330033">}</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  191: </span>
<span style="color: #ff0099">  192: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  193: </span>  <span style="color: #000099">// diagnostic print routine</span>
<span style="color: #ff0099">  194: </span>
<span style="color: #ff0099">  195: </span>  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">ostream</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">ini_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #ff0099">  196: </span>
<span style="color: #ff0099">  197: </span>  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #ff0099">  198: </span>
<span style="color: #ff0099">  199: </span><span style="color: #330033">}</span> <span style="color: #000099">// end namespace stlplus</span>
<span style="color: #ff0099">  200: </span>
<span style="color: #ff0099">  201: </span><span style="color: #990000">#endif</span>
</pre>
</body>
</html>
